---
name: design-feature-from-issue
description: 分析并设计新功能 by github issue URL
---

# 分析并设计新功能（基于 GitHub Issue）

## 任务
根据提供的 GitHub Issue URL，分析需求并设计实现方案。

## 工作流程

### 1. 需求分析阶段
- **获取 Issue 内容**：使用 `gh issue view <issue-number>` 或 WebFetch 获取完整 issue 内容
- **理解需求**：
  - 功能目标：用户想要什么
  - 使用场景：什么情况下会用到
  - 用户价值：解决什么痛点
  - 成功标准：如何判断功能是否成功
- **需求澄清**（如需要）：
  - 使用 AskUserQuestion 工具向用户确认不明确的需求
  - 确认技术选型偏好
  - 确认 UI/UX 预期
  - 确认优先级和范围

### 2. 技术调研阶段
- **现有架构分析**：
  - 使用 Explore agent 了解现有代码结构
  - 定位相关的现有功能模块
  - 分析现有的数据模型和 API
  - 了解技术栈和框架
- **依赖关系分析**：
  - 该功能依赖哪些现有模块
  - 会影响哪些现有功能
  - 需要新增哪些依赖
- **技术方案调研**：
  - 是否有类似功能可以参考
  - 需要引入新的第三方库吗
  - 性能和安全考虑

### 3. 架构设计阶段
- **系统设计**：
  - 前端设计：
    - 页面/组件结构
    - 状态管理方案
    - 路由设计
    - UI/UX 流程
  - 后端设计：
    - API 接口设计（RESTful/GraphQL）
    - 数据模型设计
    - 业务逻辑层设计
    - 数据库 schema 变更
  - 集成设计：
    - 前后端契约（请求/响应格式）
    - 第三方服务集成
    - 事件/消息设计（如适用）
- **数据流设计**：
  - 用户操作 → 前端事件 → API 调用 → 后端处理 → 数据库 → 响应 → UI 更新
  - 绘制关键数据流图
- **安全设计**（Web3 AI 交易系统 - 如适用）：
  - 密钥管理方案
  - 交易签名验证
  - AI 决策审计
  - 权限控制
  - 资金保护机制
  - 参考 /20-code-review 中的安全检查清单

### 4. 实现规划阶段
- **使用 TodoWrite 创建任务清单**：
  - 按照实现顺序列出所有任务
  - 包含前端、后端、数据库、测试等
  - 每个任务应该是可独立完成的
- **任务分解示例**：
  ```
  1. 数据库 Schema 设计和迁移
  2. 后端 API 实现
  3. 后端单元测试
  4. 前端组件开发
  5. 前端状态管理
  6. 前端路由配置
  7. 前端与后端集成
  8. 集成测试
  9. E2E 测试
  10. 文档更新
  ```
- **依赖关系标注**：
  - 哪些任务有先后依赖
  - 哪些任务可以并行进行

### 5. 风险与挑战评估
- **技术风险**：
  - 性能瓶颈（如大量数据处理）
  - 兼容性问题（浏览器、版本等）
  - 第三方依赖风险
- **业务风险**：
  - 用户体验影响
  - 数据迁移风险
  - 向后兼容性
- **安全风险**（Web3 AI 系统）：
  - 资金安全风险
  - 私钥泄露风险
  - AI 决策风险
  - 智能合约交互风险
- **缓解策略**：
  - 每个风险的应对方案
  - 降级策略和回滚方案

### 6. 测试策略
- **测试计划**：
  - 单元测试范围和目标覆盖率
  - 集成测试场景
  - E2E 测试用例
  - 性能测试（如需要）
  - 安全测试（如需要）
- **验收标准**：
  - 功能完整性验收
  - 性能指标验收
  - 安全审计通过（Web3 AI 系统）

## 设计输出要求

### 功能设计文档
请提供以下内容：

#### 1. 需求概述
- Issue URL 和标题
- 功能目标（一句话描述）
- 用户故事（User Story）
- 核心使用场景（2-3个）
- 成功标准

#### 2. 技术设计

##### 2.1 架构设计
- **系统架构图**（文字描述）
  - 前端组件层次
  - 后端模块结构
  - 数据流向
- **关键技术决策**
  - 选择的技术方案和理由
  - 不选择其他方案的原因

##### 2.2 数据模型设计
- **数据库 Schema**
  ```
  表名：xxx
  字段：
  - id: bigint (主键)
  - name: varchar(255)
  - ...
  索引：...
  外键：...
  ```
- **API 数据模型**（TypeScript/Go interfaces）

##### 2.3 API 设计
- **端点列表**
  ```
  POST   /api/v1/xxx       - 创建资源
  GET    /api/v1/xxx/:id   - 获取资源
  PUT    /api/v1/xxx/:id   - 更新资源
  DELETE /api/v1/xxx/:id   - 删除资源
  ```
- **请求/响应示例**（JSON）
- **错误处理**（状态码、错误格式）

##### 2.4 前端设计
- **页面/组件结构**
  ```
  - FeaturePage/
    - FeatureList/
    - FeatureDetail/
    - FeatureForm/
  ```
- **状态管理**（使用的状态管理方案和数据流）
- **路由设计**（路径、参数、导航流程）

##### 2.5 安全设计（Web3 AI 系统）
如果功能涉及交易、密钥、AI 决策等，必须包含：
- 密钥管理方案
- 交易验证流程
- AI 决策审计机制
- 限额保护设置
- 紧急暂停机制

#### 3. 实现计划
- **任务清单**（已通过 TodoWrite 创建）
- **时间估算**（可选）
- **里程碑**（可选）

#### 4. 风险与挑战
- **技术风险**及缓解策略
- **业务风险**及缓解策略
- **安全风险**及缓解策略（如适用）

#### 5. 测试策略
- **测试范围**
- **关键测试场景**
- **验收标准**

#### 6. 后续优化方向（可选）
- 第一版可能不包含的功能
- 未来可以改进的方向

## 关键原则

1. **需求驱动**：设计必须完全满足 issue 中的需求
2. **架构一致**：遵循项目现有的架构模式和代码风格
3. **最小可行**：第一版聚焦核心功能，避免过度设计
4. **安全第一**：对于 Web3 AI 交易系统，安全是不可妥协的
5. **可测试性**：设计时考虑如何测试
6. **可扩展性**：为未来扩展留出空间，但不过度设计

## 设计完成后

设计文档完成后，询问用户：
1. 是否需要调整设计方案
2. 是否现在开始实施（使用 ExitPlanMode 进入实施阶段）

## 开始执行

请提供 GitHub Issue URL（格式：https://github.com/owner/repo/issues/number），我将立即开始需求分析和方案设计。
